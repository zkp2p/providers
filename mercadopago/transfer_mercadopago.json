{
  "actionType": "transfer_mercado_pago",
  "proofEngine": "reclaim",
  "authLink": "https://www.mercadopago.com.ar/home",
  "url": "https://www.mercadopago.com.ar/activities/detail/{{PAYMENT_ID}}?from={{URL_PARAMS_FROM}}",
  "method": "GET",
  "body": "",
  "metadata": {
    "platform": "mercadopago",
    "urlRegex": "^https://www\\.mercadopago\\.com\\.ar/home(?:/)?(?:\\?.*)?$",
    "method": "GET",
    "fallbackUrlRegex": "",
    "fallbackMethod": "",
    "preprocessRegex": "<script\\s+[^>]*id=[\"']__PRELOADED_STATE__[\"'][^>]*>([\\s\\S]*?)</script>",
    "transactionsExtraction": {
      "transactionJsonPathListSelector": "$.pageState.mpHome.result.sections.hs_activities.content.content",
      "transactionJsonPathSelectors": {
        "recipient": "$.title",
        "amount": "$.amount.fraction",
        "date": "$.creationDate",
        "paymentId": "$.id",
        "currency": "$.amount.currency_id"
      }
    },
    "proofMetadataSelectors": [
      {
        "type": "jsonPath",
        "value": "$.pageState.mpHome.result.sections.hs_activities.content.content[{{INDEX}}].title"
      },
      {
        "type": "jsonPath",
        "value": "$.pageState.mpHome.result.sections.hs_activities.content.content[{{INDEX}}].amount.fraction"
      },
      {
        "type": "jsonPath",
        "value": "$.pageState.mpHome.result.sections.hs_activities.content.content[{{INDEX}}].id"
      }
    ]
  },
  "paramNames": [
    "PAYMENT_ID",
    "URL_PARAMS_FROM"
  ],
  "paramSelectors": [
    {
      "type": "jsonPath",
      "value": "$.pageState.mpHome.result.sections.hs_activities.content.content[{{INDEX}}].id"
    },
    {
      "type": "regex",
      "value": "from=([^&\\\"]+)"
    }
  ],
  "skipRequestHeaders": [
    "Cookie",
    "Accept-Encoding"
  ],
  "secretHeaders": [
    "Cookie"
  ],
  "responseMatches": [
    {
      "type": "regex",
      "value": "v2__detail\">(.*?)CVU: (?<recipientId>[0-9]+)</li>"
    },
    {
      "type": "regex",
      "value": "<span class=\"andes-money-amount__fraction\" aria-hidden=\"true\">(?<amt>[0-9.]+)</span><span aria-hidden=\"true\">,</span><span class=\"andes-money-amount__cents\" aria-hidden=\"true\">(?<cents>[0-9]+)</span>"
    },
    {
      "type": "regex",
      "value": "Total\",\"amount\":{\"currency_id\":\"(?<curr>[^\"]+)\""
    },
    {
      "type": "regex",
      "value": ",\"date\":\"(?<date>[^\"]+)\",\"sections\""
    },
    {
      "type": "regex",
      "value": "\"operationId\":(?<paymentId>[^,]+),\"activityName\":\"(?<paymentType>[^\"]+)\",\"activityStatus\":\"(?<paymentStatus>[^\"]+)\","
    }
  ],
  "responseRedactions": [
    {
      "jsonPath": "",
      "xPath": "",
      "regex": "v2__detail\">(.*?)CVU: (.*?)</li>"
    },
    {
      "jsonPath": "",
      "xPath": "",
      "regex": "<span class=\"andes-money-amount__fraction\" aria-hidden=\"true\">(.*?)</span><span aria-hidden=\"true\">,</span><span class=\"andes-money-amount__cents\" aria-hidden=\"true\">(.*?)</span>"
    },
    {
      "jsonPath": "",
      "xPath": "",
      "regex": "\"Total\",\"amount\":{\"currency_id\":\"(.*?)\""
    },
    {
      "jsonPath": "",
      "xPath": "",
      "regex": ",\"date\":\"(.*)\",\"sections\""
    },
    {
      "jsonPath": "",
      "xPath": "",
      "regex": "\"operationId\":(.*?),\"activityName\":\"(.*?)\",\"activityStatus\":\"(.*?),"
    }
  ],
  "mobile": {
    "additionalClientOptions": {
      "cipherSuites": [
        "TLS_AES_128_GCM_SHA256",
        "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
        "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
      ]
    },
    "includeAdditionalCookieDomains": [
      "mercadolibre.com",
      "www.mercadolibre.com"
    ],
    "internal": {
      "actionLink": "https://www.mercadopago.com.ar/money-out/transfer/",
      "actionCompletedUrlRegex": "https://www.mercadopago.com.ar/money-out/transfer/congrats\\?data=\\S+",
      "injectedJavaScript": "(function(){\n  try{\n    var DETAILS={RECIPIENT_ID:'{{RECIPIENT_ID}}',AMOUNT:'{{AMOUNT}}'};\n    function xFirst(xpath){try{var r=document.evaluate(xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return r&&r.singleNodeValue?r.singleNodeValue:null;}catch(e){return null;}}\n    function q(sel){try{return document.querySelector(sel);}catch(e){return null;}}\n\n    function setNative(node,val){\n      try{var desc=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,'value');if(desc&&desc.set)desc.set.call(node,String(val));else node.value=String(val);}catch(e){node.value=String(val);} \n      try{node.dispatchEvent(new Event('input',{bubbles:true}));}catch(e){}\n    }\n    function typeChars(node, seq){\n      try{\n        node.focus&&node.focus();\n        setNative(node,'');\n        try{node.setSelectionRange(0,0);}catch(e){}\n        for(var i=0;i<seq.length;i++){\n          var c=seq[i];\n          try{node.dispatchEvent(new InputEvent('beforeinput',{inputType:'insertText',data:c,bubbles:true,cancelable:true}))}catch(e){}\n          try{node.dispatchEvent(new KeyboardEvent('keydown',{key:c,bubbles:true}))}catch(e){}\n          setNative(node,(node.value||'')+c);\n          try{node.dispatchEvent(new KeyboardEvent('keyup',{key:c,bubbles:true}))}catch(e){}\n        }\n        try{node.dispatchEvent(new Event('change',{bubbles:true}))}catch(e){}\n        return true;\n      }catch(e){return false;}\n    }\n\n    // ===== Amount helpers (comma-decimal, no thousands dots typed) =====\n    function getHiddenValue(node){\n      try{var h=node&&node.parentElement&&node.parentElement.querySelector('.andes-amount-field__hidden-content');return h?String(h.textContent||'').trim():String(node.value||'');}catch(e){return String(node&&node.value||'');}\n    }\n    function stripDots(s){return String(s||'').replace(/\\./g,'');}\n    function normalizeAmountCommaOnly(raw){\n      try{\n        var s=String(raw||'').trim(); if(!s) return '';\n        s=s.replace(/\\s+/g,'');\n        var lastDot=s.lastIndexOf('.');\n        var lastComma=s.lastIndexOf(',');\n        var dec=(lastDot>lastComma)?'.':','; // whichever appears last is decimal\n        var parts=dec==='.'?s.split('.') : s.split(',');\n        var intPart=parts[0].replace(/[.,]/g,''); // remove all separators\n        var fracPart=(parts[1]||'').replace(/[.,]/g,'').slice(0,2);\n        return fracPart? (intPart+','+fracPart) : intPart; // use comma as decimal, no dots\n      }catch(e){return String(raw||'');}\n    }\n    function hvMatchesExpected(node, expected){\n      var hv=getHiddenValue(node);\n      return stripDots(hv)===stripDots(expected) && expected.length>0;\n    }\n    function typeAmountCommaOnly(node, raw){\n      var expected=normalizeAmountCommaOnly(raw); // e.g., '1000,12'\n      typeChars(node, expected.split(''));\n      try{ node.focus&&node.focus(); }catch(e){}\n      setTimeout(function(){\n        try{ if(!hvMatchesExpected(node, expected)){ setNative(node,''); typeChars(node, expected.split('')); try{ node.focus&&node.focus(); }catch(e){} }\n        }catch(e){}\n      }, 160);\n      // Persist for a few seconds in case mask clears it again\n      try{\n        if(!node.__zkp2p_amt_norm_guard){\n          node.__zkp2p_amt_norm_guard=true;\n          var until=Date.now()+8000;\n          var t=setInterval(function(){\n            if(Date.now()>until){ clearInterval(t); return; }\n            try{ if(!hvMatchesExpected(node, expected)){ setNative(node,''); typeChars(node, expected.split('')); } }catch(e){}\n          }, 300);\n        }\n      }catch(e){}\n    }\n\n    // ===== CVU stabilizers (unchanged) =====\n    function attachStabilizers(node,want,ms){\n      try{\n        if(node.__zkp2p_stable) return; node.__zkp2p_stable=true;\n        var until = Date.now() + (ms||5000);\n        var wantStr = String(want||'');\n        function reassert(){\n          try{\n            if(Date.now()>until) return;\n            var now=String(node.value||'');\n            if(now!==wantStr && wantStr){ setNative(node,wantStr); try{node.setAttribute('value',wantStr)}catch(e){} try{node.defaultValue=wantStr}catch(e){} try{node.dispatchEvent(new Event('change',{bubbles:true}))}catch(e){} }\n          }catch(e){}\n        }\n        node.addEventListener('blur',function(){ setTimeout(reassert,20); }, true);\n        node.addEventListener('focus',function(){ setTimeout(reassert,80); }, true);\n        node.addEventListener('input',function(){ setTimeout(reassert,120); }, true);\n        setTimeout(reassert,100);\n        var t=setInterval(function(){ if(Date.now()>until){clearInterval(t);} else { reassert(); } }, 300);\n      }catch(e){}\n    }\n\n    function fill(){\n      var ok=true;\n      // CVU (unchanged)\n      var cvu=DETAILS.RECIPIENT_ID||DETAILS.recipient||DETAILS.recipientId||DETAILS.cvu||'';\n      if(cvu){\n        var cvuEl=xFirst(\"//section[contains(@class,'new-account-form')]//input[contains(@class,'andes-form-control__field')]\")||q(\"input[name='identification_account']\")||q('section.new-account-form input.andes-form-control__field');\n        if(cvuEl&&!cvuEl.getAttribute('data-zkp2p-filled')){\n          typeChars(cvuEl, String(cvu).split(''));\n          attachStabilizers(cvuEl,cvu,6000);\n          try{ cvuEl.focus && cvuEl.focus(); }catch(e){}\n          cvuEl.setAttribute('data-zkp2p-filled','1');\n        } else if(!cvuEl){ ok=false; }\n      }\n      // Amount (comma-decimal, no thousands dots typed)\n      var amtRaw=DETAILS.AMOUNT||DETAILS.amount||DETAILS.amt||'';\n      if(amtRaw){\n        var amtEl=q('#amount-field-input')||q('input.andes-amount-field__input');\n        if(amtEl&&!amtEl.getAttribute('data-zkp2p-filled')){\n          typeAmountCommaOnly(amtEl, amtRaw);\n          try{ amtEl.focus && amtEl.focus(); }catch(e){}\n          amtEl.setAttribute('data-zkp2p-filled','1');\n        } else if(!amtEl){ ok=false; }\n      }\n      return ok;\n    }\n\n    if(!fill()){\n      var tries=0; var t=setInterval(function(){ tries++; if(fill()||tries>500){ clearInterval(t); } }, 120);\n    }\n    (function(){var push=history.pushState,rep=history.replaceState,emit=function(){try{window.dispatchEvent(new Event('locationchange'));}catch(e){}};history.pushState=function(){var r=push.apply(this,arguments);emit();return r;};history.replaceState=function(){var r=rep.apply(this,arguments);emit();return r;};window.addEventListener('popstate',emit);window.addEventListener('locationchange',function(){fill();});})();\n  }catch(e){}\n  return true;\n})();"
    }
  }
}
